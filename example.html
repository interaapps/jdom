
<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
    <div id="app"></div>
    <my-app></my-app>

</body>
</html>

<script type="module">
    import {$, $n, $c, $r, $h, $escHTML, JDOM, html} from './index.js'
    import { state, computed, watch } from './src/template/hooks.js'


    function showDialog() {
        const dialog = html`
            <div>
                <button @click=${() => dialog.remove()}>X</button>
                <h1>Hello World</h1>
                <h2>Yee</h2>

                Hallo ${name}!
            </div>
        `.appendTo(document)
    }

    const isEnabled = state(false)
    const count = state(0)

    const computedCount = computed(() => count.value * 3, [count])

    watch([count], () => {
        console.log(count.value)
    })

    const elements = state([
        {
            name: 'John'
        },
        {
            name: 'Valery'
        }
    ])

    function waitforme() {
        return new Promise((res) => {
            setTimeout(() => {
                console.log('YAA')
                res(html`<h3>HELLO WORLD!</h3>`)
            }, 2000)
        })
    }

    const name = state('')

    const myHTML = html`
        <!-- ${waitforme()} -->


        <input :bind=${name} >

        ${name}

        ${computed(() => isEnabled.value ? 'Hallo' : 'Welt', [isEnabled])}

        <br><br><br>

        <button @click=${showDialog}>Show Dialog</button>
        <br><br>
        <br><br>

        <!-- Button test test -->
        <button
                style=${{
                    background: '#347766'
                }}
                class=${computed(() => ({
                    'btn': true,
                    'primary' : count.value > 5,
                }), [count])}

                this-is-val=${count}
                @click=${() => count.value++}
        >
            The count is ${computedCount}
        </button>


        <br><br><br>

        <!-- Toggle test -->
        <button @click=${() => isEnabled.value = !isEnabled.value}>Show</button>

        <div :if=${isEnabled} @click=${() => alert('Yo')} @:create=${console.log('Created')} shit>
            Now I'm shown :o
        </div>

        <br><br><br>

        <!-- Reactive for-each -->
        ${computed(() => elements.value.map(user => html`
            <div ${user}>
                <span>${user.name}</span>
            </div>
        `), [elements])}

        <button @click=${() => elements.value = [...elements.value, {name: 'Joe', a:2}]}>Add Element</button>
    `


    console.log(myHTML)
    $(myHTML).appendTo(document)

    const app = $('#app')

    $('asd').animate({
        'test': 423
    })

    $(document).append($n('h2').text('Hallo Welt'))


    app.append(
        $n('button')
            .text('Hey')
            .click(e => {
                alert("Moin")
            })
    ).append(`<h1>Hey</h1>`)

    app.animate({background: '#FF0022'}, 1000)

    app.on('click', e => {

    })

    app.animator([
        {
            css: {
                background: '#FF0022'
            },
            duration: 1000
        },
        {
            css: {
                background: '#22FF22'
            },
            duration: 1000
        },
        {
            css: {
                background: '#FFFF22'
            },
            duration: 1000
        },
    ])

    const HomePage = $c((el, self) => {
        el.append($n('h1').text('Homepage'))

    })

    const MyApp = $c(el => {
        el.append(new HomePage())
        el.append($n('home-page'))
    })


    $h(`<h1>
        Hallo: ${$escHTML('Hello World')}
        Welt: ${$escHTML('Welt')}
    </h1>`)
        .appendTo(document)

    $r('home-page', HomePage)
    $r('my-app', MyApp)
</script>
<style>
    a {
        display: inline-block;
    }
</style>